<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>devel</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <script src="main.js"></script>
  </head>

  <body class="developer">
    <div class="container">
      <header class="header">
        <div class="text_header">ToDo</div>
        <div class="right_block">
          <div class="switcher_thems">
            <div class="wrap">
              <div class="btn_black">
                <svg
                  width="12"
                  height="12"
                  viewBox="0 0 12 12"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M6.00012 5.9035C5.371 5.27414 4.94256 4.47242 4.76893 3.59965C4.59531 2.72688 4.68428 1.82222 5.02462 1C4.05425 1.19103 3.16292 1.66716 2.46462 2.3675C0.512119 4.32 0.512119 7.486 2.46462 9.4385C4.41762 11.3915 7.58312 11.391 9.53612 9.4385C10.2363 8.74026 10.7124 7.84915 10.9036 6.879C10.0814 7.21927 9.17675 7.30821 8.30399 7.13459C7.43123 6.96096 6.62951 6.53256 6.00012 5.9035V5.9035Z"
                    fill="#D9D1E0"
                  />
                </svg>
              </div>
              <div class="btn_light active">
                <svg
                  width="12"
                  height="12"
                  viewBox="0 0 12 12"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M6.00008 2.14001C6.08849 2.14001 6.17327 2.10489 6.23578 2.04238C6.2983 1.97987 6.33342 1.89508 6.33342 1.80668V0.636678C6.33342 0.548273 6.2983 0.463488 6.23578 0.400976C6.17327 0.338464 6.08849 0.303345 6.00008 0.303345C5.91168 0.303345 5.82689 0.338464 5.76438 0.400976C5.70187 0.463488 5.66675 0.548273 5.66675 0.636678V1.80668C5.66675 1.89508 5.70187 1.97987 5.76438 2.04238C5.82689 2.10489 5.91168 2.14001 6.00008 2.14001Z"
                    fill="#F178B6"
                  />
                  <path
                    d="M6.00008 9.85999C5.91168 9.85999 5.82689 9.8951 5.76438 9.95762C5.70187 10.0201 5.66675 10.1049 5.66675 10.1933V11.3633C5.66675 11.4517 5.70187 11.5365 5.76438 11.599C5.82689 11.6615 5.91168 11.6967 6.00008 11.6967C6.08849 11.6967 6.17327 11.6615 6.23578 11.599C6.2983 11.5365 6.33342 11.4517 6.33342 11.3633V10.1933C6.33342 10.1049 6.2983 10.0201 6.23578 9.95762C6.17327 9.8951 6.08849 9.85999 6.00008 9.85999Z"
                    fill="#F178B6"
                  />
                  <path
                    d="M2.79989 3.27001C2.86365 3.32462 2.94568 3.35315 3.02957 3.34991C3.11346 3.34667 3.19304 3.31189 3.25241 3.25253C3.31177 3.19316 3.34655 3.11358 3.34979 3.02969C3.35303 2.9458 3.32449 2.86377 3.26989 2.80001L2.44322 1.97334C2.37945 1.91873 2.29743 1.8902 2.21353 1.89344C2.12964 1.89668 2.05006 1.93145 1.9907 1.99082C1.93133 2.05018 1.89656 2.12976 1.89332 2.21366C1.89007 2.29755 1.91861 2.37957 1.97322 2.44334L2.79989 3.27001Z"
                    fill="#F178B6"
                  />
                  <path
                    d="M9.20005 8.72999C9.13629 8.67539 9.05426 8.64685 8.97037 8.65009C8.88648 8.65333 8.8069 8.68811 8.74753 8.74747C8.68817 8.80684 8.65339 8.88642 8.65015 8.97031C8.64691 9.0542 8.67545 9.13623 8.73005 9.19999L9.55672 10.0267C9.62049 10.0813 9.70251 10.1098 9.78641 10.1066C9.8703 10.1033 9.94988 10.0685 10.0092 10.0092C10.0686 9.94982 10.1034 9.87024 10.1066 9.78634C10.1099 9.70245 10.0813 9.62043 10.0267 9.55666L9.20005 8.72999Z"
                    fill="#F178B6"
                  />
                  <path
                    d="M2.13989 5.99999C2.13989 5.91158 2.10477 5.8268 2.04226 5.76429C1.97975 5.70178 1.89496 5.66666 1.80656 5.66666H0.636556C0.54815 5.66666 0.463366 5.70178 0.400854 5.76429C0.338342 5.8268 0.303223 5.91158 0.303223 5.99999C0.303223 6.0884 0.338342 6.17318 0.400854 6.23569C0.463366 6.2982 0.54815 6.33332 0.636556 6.33332H1.80656C1.89496 6.33332 1.97975 6.2982 2.04226 6.23569C2.10477 6.17318 2.13989 6.0884 2.13989 5.99999Z"
                    fill="#F178B6"
                  />
                  <path
                    d="M11.3634 5.66666H10.1934C10.105 5.66666 10.0203 5.70178 9.95774 5.76429C9.89523 5.8268 9.86011 5.91158 9.86011 5.99999C9.86011 6.0884 9.89523 6.17318 9.95774 6.23569C10.0203 6.2982 10.105 6.33332 10.1934 6.33332H11.3634C11.4518 6.33332 11.5366 6.2982 11.5991 6.23569C11.6617 6.17318 11.6968 6.0884 11.6968 5.99999C11.6968 5.91158 11.6617 5.8268 11.5991 5.76429C11.5366 5.70178 11.4518 5.66666 11.3634 5.66666Z"
                    fill="#F178B6"
                  />
                  <path
                    d="M2.79989 8.72999L1.97322 9.55666C1.91861 9.62043 1.89007 9.70245 1.89332 9.78634C1.89656 9.87024 1.93133 9.94982 1.9907 10.0092C2.05006 10.0685 2.12964 10.1033 2.21353 10.1066C2.29743 10.1098 2.37945 10.0813 2.44322 10.0267L3.26989 9.19999C3.32449 9.13623 3.35303 9.0542 3.34979 8.97031C3.34655 8.88642 3.31177 8.80684 3.25241 8.74747C3.19304 8.68811 3.11346 8.65333 3.02957 8.65009C2.94568 8.64685 2.86365 8.67539 2.79989 8.72999Z"
                    fill="#F178B6"
                  />
                  <path
                    d="M9.20005 3.27001L10.0267 2.44334C10.0813 2.37957 10.1099 2.29755 10.1066 2.21366C10.1034 2.12976 10.0686 2.05018 10.0092 1.99082C9.94988 1.93145 9.8703 1.89668 9.78641 1.89344C9.70251 1.8902 9.62049 1.91873 9.55672 1.97334L8.73005 2.80001C8.67545 2.86377 8.64691 2.9458 8.65015 3.02969C8.65339 3.11358 8.68817 3.19316 8.74753 3.25253C8.8069 3.31189 8.88648 3.34667 8.97037 3.34991C9.05426 3.35315 9.13629 3.32462 9.20005 3.27001Z"
                    fill="#F178B6"
                  />
                  <path
                    d="M6 9C7.65685 9 9 7.65685 9 6C9 4.34315 7.65685 3 6 3C4.34315 3 3 4.34315 3 6C3 7.65685 4.34315 9 6 9Z"
                    fill="#F178B6"
                  />
                </svg>
              </div>
            </div>
          </div>
          <div class="bell">
            <img src="img/kolocol.svg" />
          </div>
          <div class="profile">
            <img src="img/icon.svg" />
            <div class="text_in_profile">
              <div class="name_profile">Surname N.</div>
              <div class="info_profile">Ad. information</div>
            </div>
          </div>
          <div class="exit">
            <img src="img/exit.svg" alt="">
          </div>
        </div>
        <!-- <div class="logo_and_text_right">
                <div class="text_right">Разработчик</div>
                <div class="logo">
                    <img src="img/genshina.png">
                </div>
            </div> -->
      </header>
      <div class="top_bar">
        <div class="add_task">
          <div class="btn" onclick="createNewTask();">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4 3H20C20.2652 3 20.5196 3.10536 20.7071 3.29289C20.8946 3.48043 21 3.73478 21 4V20C21 20.2652 20.8946 20.5196 20.7071 20.7071C20.5196 20.8946 20.2652 21 20 21H4C3.73478 21 3.48043 20.8946 3.29289 20.7071C3.10536 20.5196 3 20.2652 3 20V4C3 3.73478 3.10536 3.48043 3.29289 3.29289C3.48043 3.10536 3.73478 3 4 3ZM11 11H7V13H11V17H13V13H17V11H13V7H11V11Z"
                fill="#616161"/></svg>
          </div>
        </div>
        <div class="categories_tabs">
          <ul>
            <li class="active" data-status="">Все</li>
            <li data-status="new">Новые</li>
            <li data-status="progress">В процессе</li>
            <li data-status="sentToConfirm">Отправленные на подтв.</li>
            <li data-status="confirmed">Подтверждена</li>
            <li data-status="taskOnClock">Выплачена</li>
          </ul>
        </div>
        <div class="payment">
          <div class="btn btn_gold">Вывод стредств</div>
        </div>
      </div>
      <!-- <input type="checkbox" name="">  cheker -->
      <div class="table_tasks">
        <div class="table_header">
          <div class="header_row">
            <div class="status">
              <div>Статус</div>
              <div class="arrow"></div>
            </div>
            <div class="clock">
              <div>Часы</div>
              <div class="arrow"></div>
            </div>
            <div class="task_description">
              <div>Описание задачи</div>
              <div class="arrow"></div>
            </div>
          </div>
        </div>
        <div class="table_body">
          <div class="row">
            <div class="checkbox">
              <input
                type="checkbox"
                class="custom-checkbox"
                id="happy1"
                name="happy"
                value="yes"
              />
              <label for="happy1"></label>
            </div>
            <div class="status">
              <div>Статус</div>
            </div>
            <div class="clock">
              <div>Часы</div>
            </div>
            <div class="task_description">
              <div>Описание задачи</div>
            </div>
            <div class="action">
              <div class="btn btn_primery">Подтвердить</div>
            </div>
          </div>
          <div class="row">
            <div class="checkbox">
              <input
                type="checkbox"
                class="custom-checkbox"
                id="happy2"
                name="happy"
                value="yes"
              />
              <label for="happy2"></label>
            </div>
            <div class="status">
              <div>Статус</div>
            </div>
            <div class="clock">
              <div>Часы</div>
            </div>
            <div class="task_description">
              <div>Описание задачи</div>
            </div>
            <div class="action">
              <div class="btn btn_primery">Подтвердить</div>
            </div>
          </div>
          <div class="row" data-task="1234">
            <div class="checkbox">
              <input
                type="checkbox"
                class="custom-checkbox"
                id="happy3"
                name="happy"
                value="yes"
              />
              <label for="happy3"></label>
            </div>
            <div class="status">
              <div>Статус</div>
            </div>
            <div class="clock">
              <div>Часы</div>
            </div>
            <div class="task_description">
              <div>Описание задачи</div>
            </div>
            <div class="action">
              <div class="btn btn_primery">Подтвердить</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- <script>
      let taskFilterInit = () => {
        document.querySelectorAll(".categories_tabs li").forEach((li) => {
          console.log(li);
          li.addEventListener("click", (e) => {
            //находим все li и снимаем класс актив
            li.parentElement.querySelectorAll("li").forEach((li2) => {
              li2.classList.remove("active");
            });
            console.log(e.currentTarget);
            let elem = e.currentTarget;
            elem.classList.add("active");
            console.log(elem.dataset.status);
            let statusName = elem.dataset.status;
            if (statusName == "") {
              document.querySelectorAll(".row").forEach((row) => {
                row.style.display = "flex";
              });
            } else{
              document.querySelectorAll(".row").forEach((row) => {
              row.style.display = "none";
            });
            document
              .querySelectorAll(".row [data-status='" + statusName + "']")
              .forEach((div) => {
                console.log(div.parentElement);
                div.parentElement.style.display = "flex";
              });
            }
            //фильтрация
          });
        });
      };
      const STATUS_TITLES = {
        new: "Новая",
        progress: "Выполняется",
        sentToConfirm: "Отправлено на подтверждение",
        confirmed: "Подтверждена",
        taskOnClock: "Запрос на вывод часов",
        paid: "Выплачено",
      };
      function myFuncClick(event) {
        console.log("Клик мыши", event.target);
        let elem = event.target;
        elem.style.background = "green";
      }

      function changeStatus(id, status) {
        console.log("Задача  айди " + id + " подтверждена");
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/tasks/edit");
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        let data = {
          status: status,
          _id: id,
        };
        let jsonData = JSON.stringify(data);
        xhr.send(jsonData);

        xhr.onload = function () {
          if (xhr.status != 200) {
            console.log(xhr.status, xhr.statusText);
          } else {
            let result = JSON.parse(xhr.response);
            requestTasks();
          }
        };
      }
      function requestTasks(argument) {
        let xhr = new XMLHttpRequest();
        xhr.open("GET", "/api/tasks/edit");

        // 1. Создаём новый XMLHttpRequest-объект
        // 2. Настраиваем его: GET-запрос по URL /article/.../load
        // xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');

        // 3. Отсылаем запрос
        xhr.send();

        // 4. Этот код сработает после того, как мы получим ответ сервера
        xhr.onload = function () {
          if (xhr.status != 200) {
            console.log(xhr.status, xhr.statusText);
          } else {
            clearRows();
            console.log(JSON.parse(xhr.response));
            createRow(JSON.parse(xhr.response));
          }
        };

        xhr.onerror = function () {
          console.log("Запрос не удался");
        };
      }
      function myFuncHover() {
        console.log("На элемент наведен курсор мыши");
      }
      function createRow(data) {
        console.log(data[0], "ДАТА");
        for (let task of data) {
          let row = document.createElement("div");
          row.className = "row";
          row.dataset.task = task._id;

          let checkbox = document.createElement("div");
          checkbox.className = "checkbox";
          checkbox.innerHTML =
            '<input type="checkbox" class="custom-checkbox" id="' +
            task._id +
            '" name="' +
            task._id +
            '">';
          checkbox.innerHTML += '<label for="' + task._id + '"></label>';
          row.append(checkbox);

          let status = document.createElement("div");
          status.className = "status";
          status.innerHTML = "<div>" + STATUS_TITLES[task.status] + "</div>";
          status.dataset.status = task.status;
          row.append(status);

          let clock = document.createElement("div");
          clock.className = "clock";
          clock.innerHTML = "<div>" + task.hours + "</div>";
          row.append(clock);

          let description = document.createElement("div");
          description.className = "task_description";
          description.innerHTML = "<div>" + task.description + "</div>";
          row.append(description);

          let div_action = document.createElement("div");
          div_action.className = "action";
          row.append(div_action);

          let btn_primery = document.createElement("div");
          btn_primery.className = "btn btn_primery";
          btn_primery.innerHTML = "Подтвердить";
          div_action.append(btn_primery);

          let table_body = document.querySelector(".table_body");
          table_body.append(row);

          // row.addEventListener('click', myFuncClick);
          // row.addEventListener('mouseenter', myFuncHover);
          btn_primery.addEventListener("click", (e) => {
            let event = e;

            let row = e.currentTarget.parentElement.parentElement;
            console.log(row.dataset.task);
            // console.log(e.currentTarget);
            // console.log(e.currentTarget.parentElement);
            // console.log(e.currentTarget.parentElement.parentElement);
            let id, status;
            id = row.dataset.task;
            status = "confirmed";
            changeStatus(id, status);
          });
          let changeCellData = (e) => {
            let targetElem = e.currentTarget;
            let targetClassName = targetElem.className;
            let id = targetElem.parentElement.dataset.task;
            if (targetElem.classList.contains("editing")) {
              return;
            }
            targetElem.classList.add("editing");
            if (targetClassName != "status") {
              let input = document.createElement("input");
              input.type = "text";
              targetElem.append(input);
              input.addEventListener("blur", () => {
                targetElem.classList.remove("editing");
                let newValue = input.value;
                input.remove();
                targetElem.children[0].innerHTML = newValue;
                //save данных введенех в инпут
                let xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/tasks/edit");
                xhr.setRequestHeader(
                  "Content-Type",
                  "application/json;charset=UTF-8"
                );
                let data = {
                  _id: id,
                };
                if (targetElem.classList.contains("clock")) {
                  data.hours = newValue;
                }
                if (targetElem.classList.contains("task_description")) {
                  data.description = newValue;
                }
                let jsonData = JSON.stringify(data);
                xhr.send(jsonData);

                xhr.onload = function () {
                  if (xhr.status != 200) {
                    console.log(xhr.status, xhr.statusText);
                  } else {
                    let result = JSON.parse(xhr.response);
                    requestTasks();
                  }
                };
              });
            } else {
              let select = document.createElement("select");
              select.innerHTML = `
                        <option value="new">${STATUS_TITLES["new"]}</option>
                        <option value="progress">${STATUS_TITLES["progress"]}</option>
                        <option value="sentToConfirm">${STATUS_TITLES["sentToConfirm"]}</option>
                        <option value="confirmed">${STATUS_TITLES["confirmed"]}</option>
                        <option value="taskOnClock">${STATUS_TITLES["taskOnClock"]}</option>
                        <option value="paid">${STATUS_TITLES["paid"]}</option>
                    `;
              targetElem.append(select);
              select.addEventListener("change", () => {
                targetElem.classList.remove("editing");
                let newValue = select.options[select.selectedIndex].text;
                select.remove();
                targetElem.children[0].innerHTML = newValue;
                //save данных селект на сервер
                let xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/tasks/edit");
                xhr.setRequestHeader(
                  "Content-Type",
                  "application/json;charset=UTF-8"
                );
                let data = {
                  _id: id,
                  status: select.value,
                };
                let jsonData = JSON.stringify(data);
                xhr.send(jsonData);

                xhr.onload = function () {
                  if (xhr.status != 200) {
                    console.log(xhr.status, xhr.statusText);
                  } else {
                    let result = JSON.parse(xhr.response);
                    requestTasks();
                  }
                };
              });
            }
          };
          status.addEventListener("click", changeCellData);
          clock.addEventListener("click", changeCellData);
          description.addEventListener("click", changeCellData);
          // btn_primery.addEventListener('click', changeStatus);
        }
      }

      function clearRows() {
        let table_body = document.querySelector(".table_body");
        table_body.innerHTML = "";
      }

      function createNewTask() {
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/tasks/add");
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        let data = {
          status: "new",
          hours: "4",
          description: "Do 4",
        };
        let jsonData = JSON.stringify(data);
        xhr.send(jsonData);

        xhr.onload = function () {
          if (xhr.status != 200) {
            console.log(xhr.status, xhr.statusText);
          } else {
            let result = JSON.parse(xhr.response);
            result = [result];
            console.log(JSON.parse(xhr.response));
            createRow(result);
          }
        };
      }

      function requestTasks(argument) {
        let xhr = new XMLHttpRequest();
        xhr.open("GET", "/api/tasks");

        // 1. Создаём новый XMLHttpRequest-объект
        // 2. Настраиваем его: GET-запрос по URL /article/.../load
        // xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');

        // 3. Отсылаем запрос
        xhr.send();

        // 4. Этот код сработает после того, как мы получим ответ сервера
        xhr.onload = function () {
          if (xhr.status != 200) {
            console.log(xhr.status, xhr.statusText);
          } else {
            clearRows();
            console.log(JSON.parse(xhr.response));
            createRow(JSON.parse(xhr.response));
          }
        };

        xhr.onerror = function () {
          console.log("Запрос не удался");
        };
      }
      document.addEventListener("DOMContentLoaded", () => {
        requestTasks();
        taskFilterInit();
      });
    </script> -->
  </body>
</html>
